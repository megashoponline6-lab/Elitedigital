<% var title = 'Mi Panel'; %>
<h2 class="mb-3">Hola, <%= user.nombre %> üëã</h2>

<div class="row g-3">

  <!-- üßæ DATOS DEL USUARIO -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5>Mis datos</h5>
        <p class="mb-1"><strong>Nombre:</strong> <%= user.nombre %> <%= user.apellido %></p>
        <p class="mb-1"><strong>Pa√≠s:</strong> <%= user.pais %></p>
        <p class="mb-1"><strong>Correo:</strong> <%= user.correo %></p>
        <% if (user.telefono) { %>
          <p class="mb-1"><strong>Tel√©fono:</strong> <%= user.telefono %></p>
        <% } %>
        <p class="display-6">Saldo: $<%= user.saldo %> MXN</p>
        <div class="mt-3">
          <a href="/catalogo" class="btn btn-danger btn-sm">Comprar suscripci√≥n</a>
        </div>
      </div>
    </div>
  </div>

  <!-- üóìÔ∏è SUSCRIPCI√ìN ACTIVA -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5>Renovaci√≥n</h5>
        <% if (sub) { %>
          <p class="mb-1"><strong>Servicio:</strong> <%= sub.prod_nombre %></p>
          <p class="mb-1">
            <strong>Vence:</strong> <%= dayjs(sub.vence_en).format('DD/MM/YYYY') %>
            <% if (dias !== null) { %>
              <span class="badge text-bg-warning ms-2"><%= dias %> d√≠as</span>
            <% } %>
          </p>
          <div class="alert alert-warning mt-2">Te avisaremos cuando la fecha est√© cerca.</div>
        <% } else { %>
          <p>No tienes una suscripci√≥n activa a√∫n.</p>
        <% } %>
      </div>
    </div>
  </div>

  <!-- üí¨ CREDENCIALES ENTREGADAS -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5>Mis credenciales entregadas</h5>
        <% if (asignaciones && asignaciones.length) { %>
          <div class="table-responsive">
            <table class="table table-dark table-sm align-middle mb-0">
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Correo</th>
                  <th>Contrase√±a</th>
                  <th>Vence</th>
                </tr>
              </thead>
              <tbody>
                <% asignaciones.forEach(a => { %>
                  <tr>
                    <td><%= a.prod_nombre %></td>
                    <td><code><%= a.acc_correo %></code></td>
                    <td><code><%= a.acc_password %></code></td>
                    <td><%= dayjs(a.end_at).format('DD/MM/YYYY') %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <p class="text-secondary small mb-0">A√∫n no tienes credenciales asignadas.</p>
        <% } %>
      </div>
    </div>
  </div>

</div>
