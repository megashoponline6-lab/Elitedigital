<% var title = 'Mi Panel'; %>
<h2 class="mb-3">Hola, <%= user.nombre %> üëã</h2>

<!-- Mensajes de confirmaci√≥n -->
<% if (ok) { %>
  <div class="alert alert-success"><%= ok %></div>
<% } %>
<% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
<% } %>

<div class="row g-3">

  <!-- üßæ DATOS DEL USUARIO -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5 class="fw-bold text-danger">Mis datos</h5>
        <p class="mb-1"><strong>Nombre:</strong> <%= user.nombre %> <%= user.apellido %></p>
        <p class="mb-1"><strong>Pa√≠s:</strong> <%= user.pais %></p>
        <p class="mb-1"><strong>Correo:</strong> <%= user.correo %></p>
        <% if (user.telefono) { %>
          <p class="mb-1"><strong>Tel√©fono:</strong> <%= user.telefono %></p>
        <% } %>
        <p class="display-6 text-success mt-3">Saldo: $<%= user.saldo %> MXN</p>
        <div class="mt-3">
          <a href="/catalogo" class="btn btn-danger btn-sm w-100">Comprar suscripci√≥n</a>
        </div>
      </div>
    </div>
  </div>

  <!-- üóìÔ∏è SUSCRIPCI√ìN ACTIVA -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5 class="fw-bold text-danger">Suscripci√≥n activa</h5>
        <% if (sub) { %>
          <p class="mb-1"><strong>Servicio:</strong> <%= sub.prod_nombre %></p>
          <p class="mb-1">
            <strong>Vence:</strong> <%= dayjs(sub.vence_en).format('DD/MM/YYYY') %>
            <% if (dias !== null) { %>
              <span class="badge text-bg-warning ms-2"><%= dias %> d√≠as</span>
            <% } %>
          </p>
          <div class="alert alert-warning mt-2 small">
            Te avisaremos cuando la fecha est√© cerca.
          </div>
        <% } else { %>
          <div class="alert alert-secondary small mb-0">
            No tienes una suscripci√≥n activa a√∫n.<br>
            <a href="/catalogo" class="text-danger">Compra una para comenzar.</a>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <!-- üîê CREDENCIALES ENTREGADAS -->
  <div class="col-md-4">
    <div class="card bg-black border-secondary rounded-4">
      <div class="card-body">
        <h5 class="fw-bold text-danger">Mis credenciales entregadas</h5>
        <% if (asignaciones && asignaciones.length) { %>
          <div class="table-responsive">
            <table class="table table-dark table-sm align-middle mb-0">
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Correo</th>
                  <th>Contrase√±a</th>
                  <th>Vence</th>
                </tr>
              </thead>
              <tbody>
                <% asignaciones.forEach(a => { %>
                  <tr>
                    <td><%= a.prod_nombre %></td>
                    <td><code><%= a.acc_correo %></code></td>
                    <td><code><%= a.acc_password %></code></td>
                    <td><%= dayjs(a.end_at).format('DD/MM/YYYY') %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <p class="text-secondary small mb-0">A√∫n no tienes credenciales asignadas.</p>
        <% } %>
      </div>
    </div>
  </div>

</div>

<hr class="my-4">

<!-- üîó Botones de acci√≥n -->
<div class="text-center">
  <a href="https://t.me/EliteflixSoporte" target="_blank" class="btn btn-outline-danger me-2">
    üí¨ Soporte Telegram
  </a>
  <a href="https://t.me/EliteflixCanal" target="_blank" class="btn btn-danger">
    üì¢ Canal Oficial
  </a>
</div>
