<% var title = 'Panel Admin'; %>

<!-- ‚úÖ Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
  <h2 class="fw-bold text-danger mb-0">
    <i class="bi bi-speedometer2 me-2"></i>Panel de Administraci√≥n
  </h2>

  <!-- üîç Barra de b√∫squeda -->
  <form class="d-flex" method="get" action="/admin/panel">
    <input type="search" name="q" class="form-control bg-dark text-light border-secondary me-2"
           placeholder="Buscar usuario, servicio o cuenta..." value="<%= q || '' %>">
    <button class="btn btn-outline-danger" type="submit"><i class="bi bi-search"></i></button>
  </form>

  <div>
    <a href="/admin/cambiar-password" class="btn btn-warning me-2">
      <i class="bi bi-key-fill me-1"></i>Contrase√±a
    </a>
    <a href="/admin/logout" class="btn btn-outline-light">
      <i class="bi bi-box-arrow-right me-1"></i>Salir
    </a>
  </div>
</div>

<!-- üÜï Bot√≥n para crear nuevo producto -->
<div class="mb-3">
  <a href="/admin/producto/nuevo" class="btn btn-danger shadow-sm">
    <i class="bi bi-plus-circle me-1"></i> Nuevo producto
  </a>
</div>

<!-- üîî Mensajes -->
<% if (ok) { %>
  <div class="alert alert-success border-0 rounded-4 shadow-sm d-flex align-items-center mt-2">
    <i class="bi bi-check-circle-fill fs-5 me-2"></i>
    <span><%= ok %></span>
  </div>
<% } %>

<% if (error) { %>
  <div class="alert alert-danger border-0 rounded-4 shadow-sm d-flex align-items-center mt-2">
    <i class="bi bi-exclamation-triangle-fill fs-5 me-2"></i>
    <span><%= error %></span>
  </div>
<% } %>

<div class="row g-4 mt-1">

  <!-- üßÆ RESUMEN -->
  <div class="col-lg-12">
    <div class="card bg-black border-secondary rounded-4 shadow-sm">
      <div class="card-body">
        <h5 class="fw-semibold mb-3">
          <i class="bi bi-graph-up-arrow me-2"></i>Resumen general
        </h5>
        <div class="row text-center">
          <div class="col-md-2">
            <div class="fs-4 fw-bold text-light">$<%= (totSaldo && totSaldo.s) ? totSaldo.s : 0 %></div>
            <div class="text-secondary small">Saldo total</div>
          </div>
          <div class="col-md-2">
            <div class="fs-4 fw-bold text-light">$<%= (totManualMes && totManualMes.s) ? totManualMes.s : 0 %></div>
            <div class="text-secondary small">Ventas manuales (mes)</div>
          </div>
          <div class="col-md-2">
            <div class="fs-4 fw-bold text-light"><%= (totSubsAct && totSubsAct.c) ? totSubsAct.c : 0 %></div>
            <div class="text-secondary small">Subs activas</div>
          </div>
          <div class="col-md-3">
            <div class="fs-4 fw-bold text-success"><%= cuentasActivas || 0 %></div>
            <div class="text-secondary small">Cuentas activas</div>
          </div>
          <div class="col-md-3">
            <div class="fs-4 fw-bold text-warning"><%= cuentasVendidas || 0 %></div>
            <div class="text-secondary small">Cuentas vendidas</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üõçÔ∏è PRODUCTOS -->
  <div class="col-lg-12">
    <div class="card bg-black border-secondary rounded-4 shadow-sm">
      <div class="card-body">
        <h5 class="fw-semibold mb-3"><i class="bi bi-box-seam-fill me-2"></i>Productos</h5>
        <div class="table-responsive">
          <table class="table table-dark table-sm align-middle mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Descripci√≥n</th>
                <th>Precios</th>
                <th>Cupos</th>
                <th>Activo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (productos && productos.length) { %>
                <% productos.forEach(p => { %>
                  <tr>
                    <td><%= p.id %></td>
                    <td>
                      <% if (p.logo) { %>
                        <img src="<%= p.logo %>" style="height:30px;width:auto;margin-right:8px;"> 
                      <% } %>
                      <%= p.nombre %>
                    </td>
                    <td><%= p.descripcion || '-' %></td>
                    <td>
                      1M: $<%= p.precio1 %><br>
                      2M: $<%= p.precio2 %><br>
                      3M: $<%= p.precio3 %>
                    </td>
                    <td><%= p.cupos_usados %> / <%= p.cupos_total %></td>
                    <td><%= p.activo ? '‚úÖ' : '‚ùå' %></td>
                    <td>
                      <a href="/admin/producto/editar/<%= p.id %>" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil-square me-1"></i>Editar
                      </a>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr><td colspan="7" class="text-center text-secondary">No hay productos cargados.</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- üí∞ RECARGAR SALDO -->
  <div class="col-lg-6">
    <div class="card bg-black border-secondary rounded-4 shadow-sm">
      <div class="card-body">
        <h5 class="fw-semibold mb-3"><i class="bi bi-cash-coin me-2"></i>Recargar saldo</h5>
        <form class="row g-2" method="post" action="/admin/recargar">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <div class="col-md-4"><input class="form-control" name="correo" type="email" placeholder="Correo usuario" required></div>
          <div class="col-md-3"><input class="form-control" name="monto" type="number" placeholder="Monto" required></div>
          <div class="col-md-3"><input class="form-control" name="nota" placeholder="Nota (opcional)"></div>
          <div class="col-md-2"><button class="btn btn-danger w-100">Cargar</button></div>
        </form>
      </div>
    </div>
  </div>

  <!-- üë• USUARIOS -->
  ... (tu bloque de usuarios, cuentas y vendidas sigue igual) ...
</div>
